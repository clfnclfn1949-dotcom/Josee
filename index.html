<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RIVAL; REVIVAL - 문장의 부활</title>
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --navy: #0A1931; --yellow: #FFC947; --white: #FFFFFF;
      --bg: #F2F2F2; --border: #DDDDDD; --text-main: #1A1A1A; --text-sub: #666666;
      --red: #D9534F; --green: #5CB85C; --purple: #9B59B6;
    }
    * { box-sizing: border-box; }
    body { background: var(--bg); font-family: 'Nanum Gothic', sans-serif; margin: 0; color: var(--text-main); line-height: 1.6; display: flex; flex-direction: column; min-height: 100vh; }
    
    nav { background: var(--navy); display: flex; justify-content: space-between; align-items: center; padding: 10px 40px; position: sticky; top: 0; z-index: 1000; }
    .nav-links { display: flex; gap: 20px; }
    .nav-links a { color: var(--white); text-decoration: none; font-weight: 700; font-size: 0.85rem; cursor: pointer; }
    .nav-links a.active, .nav-links a:hover { color: var(--yellow); }
    .user-info { color: rgba(255, 201, 71, 0.9); font-size: 0.75rem; display: flex; align-items: center; gap: 10px; }
    .logout-btn { background: none; border: 1px solid rgba(255, 255, 255, 0.4); color: white; cursor: pointer; font-size: 0.6rem; padding: 2px 6px; border-radius: 3px; }

    header { background: var(--navy); color: var(--white); padding: 60px 20px; text-align: center; border-bottom: 8px solid var(--yellow); }
    header h1 { font-size: 2.5rem; margin: 0; color: var(--yellow); letter-spacing: 8px; font-weight: 800; }
    header p { opacity: 0.8; margin-top: 15px; font-size: 0.9rem; letter-spacing: 2px; }

    .content-layer { display: none; max-width: 1000px; margin: 40px auto; padding: 0 20px; flex: 1; }
    .content-layer.active { display: block; animation: fadeInUp 0.4s ease-out; }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    .card { background: var(--white); border: 1px solid var(--border); padding: 40px; margin-bottom: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
    .card-title { font-size: 1.2rem; font-weight: 800; margin-bottom: 25px; border-bottom: 2px solid var(--navy); padding-bottom: 10px; display: inline-block; }

    .brand-intro { text-align: center; margin: 40px 0 60px 0; word-break: keep-all; }
    .brand-intro h2 { font-size: 1.6rem; font-weight: 800; color: var(--navy); margin-bottom: 20px; }
    
    .process-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); border: 1px solid var(--navy); margin-top: 20px; }
    .process-step { padding: 40px 20px; border-right: 1px solid var(--navy); background: #fff; position: relative; }
    .process-step:last-child { border-right: none; }
    .process-step .step-num { font-size: 3rem; font-weight: 800; opacity: 0.1; position: absolute; top: -10px; left: 10px; }

    .secret-vault { background: #f9f9f9; border: 2px dashed var(--navy); padding: 20px; text-align: center; margin: 15px 0; }
    .vault-hidden { filter: blur(8px); opacity: 0.3; transition: 0.5s; user-select: none; }
    .vault-visible { filter: blur(0); opacity: 1; }

    .novel-list-item { display: flex; flex-direction: column; padding: 20px; border: 1px solid var(--border); margin-bottom: 15px; background: #fff; }
    .novel-list-item.clickable { cursor: pointer; flex-direction: row; justify-content: space-between; align-items: center; }
    .novel-list-item.clickable:hover { border-color: var(--navy); }

    .progress-bg { background: #eee; height: 10px; border-radius: 5px; overflow: hidden; margin: 20px 0; }
    .progress-fill { height: 100%; background: var(--navy); width: 0%; transition: 1s; }

    input, textarea, select { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid var(--border); font-family: inherit; font-size: 1rem; }
    .btn { background: var(--navy); color: var(--yellow); border: none; padding: 15px 30px; font-weight: 800; cursor: pointer; width: 100%; font-size: 1rem; }
    .btn:hover { opacity: 0.9; }
    .btn-sm { padding: 8px 16px; font-size: 0.8rem; width: auto; }
    .btn-danger { background: var(--red); color: white; margin-top: 10px; }
    .btn-secondary { background: #eee; color: #333; }

    .edit-panel { margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee; display: none; }

    footer { background: #EAEAEA; padding: 40px 20px; font-size: 0.85rem; border-top: 1px solid var(--border); margin-top: 60px; text-align: center; }
  </style>
</head>
<body>

<nav>
  <div class="nav-links">
    <a onclick="showPage('home')" id="link-home">HOME</a>
    <a onclick="showPage('writer')" id="link-writer">WRITER</a>
    <a onclick="showPage('reader')" id="link-reader">READER</a>
    <a onclick="showPage('published')" id="link-published">PUBLISHED</a>
    <a onclick="showPage('mypage')" id="link-mypage">MY PAGE</a>
    <a onclick="showPage('admin')" id="link-admin" style="display:none; color:var(--purple);">ADMIN</a>
  </div>
  <div id="auth-nav" class="user-info"></div>
</nav>

<header>
  <h1>RIVAL, RE; VIVAL</h1>
  <p>BAUHAUS INSPIRED PUBLISHING PLATFORM</p>
</header>

<div id="home" class="content-layer active">
  <div id="auth-ui" style="margin-bottom: 40px;"></div>
  <section class="brand-intro">
    <h2>라이터(Writer)와 리더(Reader)를 잇다</h2>
    <p>본 플랫폼은 관리자조차 실시간 수치를 열람할 수 없도록 설계되었습니다.<br>오직 작가 본인만이 자신의 투쟁을 확인할 수 있습니다.</p>
  </section>
  <div class="card">
    <div class="card-title">PROCESS</div>
    <div class="process-container">
      <div class="process-step"><div class="step-num">01</div><b>투고</b></div>
      <div class="process-step"><div class="step-num">02</div><b>검증</b></div>
      <div class="process-step"><div class="step-num">03</div><b>펀딩</b></div>
      <div class="process-step"><div class="step-num">04</div><b>부활</b></div>
    </div>
  </div>
</div>

<div id="reader" class="content-layer">
  <div id="reader-list-view">
    <div class="card"><div class="card-title">CURATION LIST</div><div id="novel-list"></div></div>
  </div>
  <div id="reader-detail-view" style="display:none;">
    <div onclick="toggleReaderView('list')" style="cursor:pointer; margin-bottom:20px; font-weight:800;">← BACK TO LIST</div>
    <div id="novel-detail-content"></div>
  </div>
</div>

<div id="writer" class="content-layer"><div class="card"><div class="card-title">SUBMIT</div><div id="writer-form-area"></div></div></div>
<div id="published" class="content-layer"><div class="card"><div class="card-title">COLLECTION</div><div id="published-grid" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(250px, 1fr)); gap:20px;"></div></div></div>
<div id="mypage" class="content-layer"><div class="card"><div class="card-title">MY DASHBOARD</div><div id="mypage-content"></div></div></div>
<div id="admin" class="content-layer"><div class="card"><div class="card-title">ADMIN (Blind Mode)</div><div id="admin-manage"></div></div></div>

<script>
  let users = JSON.parse(localStorage.getItem('rv_users')) || [];
  let currentUser = JSON.parse(localStorage.getItem('rv_current')) || null;
  let novels = JSON.parse(localStorage.getItem('rv_novels')) || [];
  let publishedBooks = JSON.parse(localStorage.getItem('rv_books')) || [];
  
  const ADMIN_ID = "admin";
  const ADMIN_PW = "kt91107361!";

  function showPage(id) {
    document.querySelectorAll('.content-layer').forEach(l => l.classList.remove('active'));
    document.querySelectorAll('.nav-links a').forEach(a => a.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.getElementById('link-' + id).classList.add('active');
    
    if(id === 'home') renderAuthUI();
    if(id === 'writer') renderWriterForm();
    if(id === 'reader') toggleReaderView('list');
    if(id === 'published') renderPublished();
    if(id === 'mypage') renderMyPage();
    if(id === 'admin') renderAdmin();
    updateNav();
  }

  function updateNav() {
    const nav = document.getElementById('auth-nav');
    if(currentUser) {
      nav.innerHTML = `<span>${currentUser.name}님</span> <button class="logout-btn" onclick="logout()">LOGOUT</button>`;
      document.getElementById('link-admin').style.display = (currentUser.id === ADMIN_ID) ? 'inline-block' : 'none';
    } else {
      nav.innerHTML = "SIGN IN REQUIRED";
      document.getElementById('link-admin').style.display = 'none';
    }
  }

  function renderAuthUI() {
    const area = document.getElementById('auth-ui');
    if(currentUser) {
      area.innerHTML = `<div class="card" style="text-align:center;"><b>WELCOME, ${currentUser.name}.</b></div>`;
    } else {
      area.innerHTML = `
        <div class="card" style="max-width:500px; margin:0 auto;">
          <h3>LOGIN / JOIN</h3>
          <input type="text" id="li-id" placeholder="ID">
          <input type="password" id="li-pw" placeholder="PW">
          <button class="btn" onclick="login()">SIGN IN</button>
          <hr style="margin:20px 0; border:0; border-top:1px solid #eee;">
          <h4 style="margin-top:30px;">새 계정 만들기</h4>
          <select id="rg-role">
            <option value="writer">작가(Writer)</option>
            <option value="reader">독자(Reader)</option>
          </select>
          <input type="text" id="rg-id" placeholder="New ID">
          <input type="password" id="rg-pw" placeholder="New PW">
          <input type="text" id="rg-name" placeholder="Name">
          <button class="btn btn-secondary" onclick="signup()">CREATE ACCOUNT</button>
        </div>`;
    }
  }

  function login() {
    const id = document.getElementById('li-id').value.trim();
    const pw = document.getElementById('li-pw').value.trim();
    if(!id || !pw) return alert("ID와 비밀번호를 입력해주세요.");
    
    if(id === ADMIN_ID && pw === ADMIN_PW) {
      currentUser = { id: ADMIN_ID, name: "관리자", role: "admin" };
      localStorage.setItem('rv_current', JSON.stringify(currentUser));
      showPage('home');
      return;
    }
    
    const user = users.find(u => u.id === id && u.pw === pw);
    if(!user) return alert("아이디 또는 비밀번호가 틀립니다.");
    
    currentUser = user;
    localStorage.setItem('rv_current', JSON.stringify(currentUser));
    showPage('home');
  }

  function signup() {
    const id = document.getElementById('rg-id').value.trim();
    const pw = document.getElementById('rg-pw').value.trim();
    const name = document.getElementById('rg-name').value.trim();
    const role = document.getElementById('rg-role').value;
    if(!id || !pw || !name) return alert("모든 내용을 입력해주세요.");
    if(users.find(u => u.id === id) || id === ADMIN_ID) return alert("사용할 수 없는 ID입니다.");
    
    users.push({id, pw, name, role});
    localStorage.setItem('rv_users', JSON.stringify(users));
    alert("가입 성공!");
    renderAuthUI();
  }

  function logout() {
    currentUser = null;
    localStorage.removeItem('rv_current');
    showPage('home');
  }

  function renderWriterForm() {
    const area = document.getElementById('writer-form-area');
    if(!currentUser || currentUser.role !== 'writer') {
      area.innerHTML = "<p style='text-align:center; padding:40px;'>작가 회원만 투고 가능합니다.</p>";
      return;
    }
    area.innerHTML = `
      <input type="text" id="wt-title" placeholder="제목">
      <textarea id="wt-content" rows="10" placeholder="원고 내용을 입력하세요"></textarea>
      <button class="btn" onclick="saveNovel()">투고하기</button>`;
  }

  function saveNovel() {
    const t = document.getElementById('wt-title').value.trim();
    const c = document.getElementById('wt-content').value.trim();
    if(!t || !c) return alert("제목과 내용을 입력해주세요.");
    
    novels.push({ id: Date.now(), authorId: currentUser.id, author: currentUser.name, title: t, content: c, stars: 0 });
    localStorage.setItem('rv_novels', JSON.stringify(novels));
    alert("투고 완료!");
    showPage('reader');
  }

  function toggleReaderView(view) {
    document.getElementById('reader-list-view').style.display = (view === 'list') ? 'block' : 'none';
    document.getElementById('reader-detail-view').style.display = (view === 'detail') ? 'block' : 'none';
    if(view === 'list') renderNovels();
  }

  function renderNovels() {
    const area = document.getElementById('novel-list');
    if(novels.length === 0) {
      area.innerHTML = "<p style='text-align:center; padding:40px;'>투고된 원고가 없습니다.</p>";
      return;
    }
    area.innerHTML = "";
    novels.slice().reverse().forEach(n => {
      const div = document.createElement('div');
      div.className = 'novel-list-item clickable';
      div.onclick = () => showDetail(n.id);
      div.innerHTML = `<b>『${n.title}』</b> <span>${n.author}</span>`;
      area.appendChild(div);
    });
  }

  function showDetail(id) {
    const n = novels.find(x => x.id === id);
    if(!n) return;
    const per = Math.min((n.stars / 10000) * 100, 100).toFixed(1);
    document.getElementById('novel-detail-content').innerHTML = `
      <div class="card">
        <h3>『${n.title}』</h3>
        <p>작가: ${n.author}</p>
        <div class="progress-bg"><div class="progress-fill" style="width:${per}%"></div></div>
        <p style="font-size:0.8rem; color:var(--text-sub);">* 창작자 보호를 위해 수치는 비공개 집계됩니다.</p>
        <div style="display:flex; gap:10px; align-items:center;">
          <input type="number" id="v-count" value="1" min="1" max="10" style="width:100px; margin-bottom:0;">
          <button class="btn btn-sm" onclick="vote(${n.id})">별점 던지기 (500원)</button>
        </div>
      </div>
      <div class="card"><h4>원고 전문</h4><div style="white-space:pre-wrap;">${n.content}</div></div>`;
    toggleReaderView('detail');
  }

  function vote(id) {
    if(!currentUser) return alert("로그인 후 이용 가능합니다.");
    const n = novels.find(x => x.id === id);
    
    // 작가 본인 투표 차단
    if(currentUser.id === n.authorId) return alert("자신의 작품에는 투표할 수 없습니다.");

    const count = parseInt(document.getElementById('v-count').value);
    n.stars += count;
    localStorage.setItem('rv_novels', JSON.stringify(novels));
    alert(`별점 ${count}개를 투표했습니다!`);
    showDetail(id);
  }

  function renderMyPage() {
    const area = document.getElementById('mypage-content');
    if(!currentUser) return area.innerHTML = "<p style='text-align:center; padding:40px;'>로그인이 필요합니다.</p>";
    
    if(currentUser.role === 'writer') {
      const my = novels.filter(n => n.authorId === currentUser.id);
      area.innerHTML = `<h4>나의 투고 현황 (${my.length}건)</h4>`;
      if(my.length === 0) return area.innerHTML += "<p style='text-align:center; padding:20px;'>투고한 작품이 없습니다.</p>";
      
      my.forEach(n => {
        area.innerHTML += `
          <div class="novel-list-item">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <b>『${n.title}』</b>
                <div>
                    <button class="btn btn-sm btn-secondary" onclick="toggleEditPanel(${n.id})">수정</button>
                    <button class="btn btn-sm btn-danger" onclick="deleteNovel(${n.id})">삭제</button>
                </div>
            </div>
            <div class="secret-vault">
              <div id="vault-${n.id}" class="vault-hidden">★ ${n.stars}</div>
              <button class="btn btn-sm" id="btn-v-${n.id}" style="margin-top:10px; background:var(--yellow); color:var(--navy);" onclick="unlock(${n.id})">비밀 금고 열기</button>
            </div>
            <div id="edit-panel-${n.id}" class="edit-panel">
                <input type="text" id="edit-title-${n.id}" value="${n.title}">
                <textarea id="edit-content-${n.id}" rows="8">${n.content}</textarea>
                <button class="btn btn-sm" onclick="updateNovel(${n.id})">저장하기</button>
            </div>
          </div>`;
      });
    } else {
      area.innerHTML = "<p style='text-align:center; padding:40px;'>독자 대시보드 (준비 중)</p>";
    }
  }

  function unlock(id) {
    document.getElementById('vault-' + id).className = 'vault-visible';
    document.getElementById('btn-v-' + id).style.display = 'none';
  }

  function toggleEditPanel(id) {
    const panel = document.getElementById(`edit-panel-${id}`);
    panel.style.display = (panel.style.display === 'block') ? 'none' : 'block';
  }

  function updateNovel(id) {
    const newTitle = document.getElementById(`edit-title-${id}`).value.trim();
    const newContent = document.getElementById(`edit-content-${id}`).value.trim();
    if(!newTitle || !newContent) return alert("내용을 입력해주세요.");

    const idx = novels.findIndex(n => n.id === id);
    novels[idx].title = newTitle;
    novels[idx].content = newContent;
    localStorage.setItem('rv_novels', JSON.stringify(novels));
    alert("수정되었습니다.");
    renderMyPage();
  }

  function deleteNovel(id) {
    if(!confirm("정말로 삭제하시겠습니까? 데이터는 복구되지 않습니다.")) return;
    novels = novels.filter(n => n.id !== id);
    localStorage.setItem('rv_novels', JSON.stringify(novels));
    renderMyPage();
  }

  function renderAdmin() {
    const area = document.getElementById('admin-manage');
    if(novels.length === 0) return area.innerHTML = "<p>관리할 원고가 없습니다.</p>";
    area.innerHTML = novels.map(n => `
      <div style="padding:10px; border-bottom:1px solid #eee; display:flex; justify-content:space-between;">
        <span>『${n.title}』 - ${n.author}</span>
        <span style="color:var(--purple); font-size:0.7rem;">[수치 봉인 모드]</span>
      </div>`).join('');
  }

  function renderPublished() {
    const grid = document.getElementById('published-grid');
    grid.innerHTML = (publishedBooks.length === 0) ? "<p>준비 중입니다.</p>" : publishedBooks.map(b => `
        <div class="card" style="text-align:center;"><img src="${b.img}" style="max-width:100%;"><h4>${b.title}</h4></div>`).join('');
  }

  showPage('home');
</script>
</body>
</html>
