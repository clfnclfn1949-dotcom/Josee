<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>RIVAL; REVIVAL</title>
    <style>
        :root { --navy: #0A1931; --yellow: #FFC947; --white: #FFFFFF; }
        body { background: #F2F2F2; font-family: sans-serif; margin: 0; padding: 0; }
        nav { background: var(--navy); padding: 15px 40px; display: flex; justify-content: space-between; align-items: center; color: white; }
        .nav-links a { color: white; margin-right: 20px; cursor: pointer; text-decoration: none; font-weight: bold; font-size: 0.9rem; }
        header { background: var(--navy); color: var(--yellow); padding: 40px; text-align: center; border-bottom: 5px solid var(--yellow); }
        .container { max-width: 800px; margin: 30px auto; padding: 20px; }
        .card { background: white; padding: 30px; margin-bottom: 20px; border: 1px solid #ddd; }
        .hidden { display: none; }
        input, textarea, select { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; }
        .btn { background: var(--navy); color: var(--yellow); border: none; padding: 12px; cursor: pointer; width: 100%; font-weight: bold; }
        
        .vault-box { background: #f9f9f9; border: 2px dashed var(--navy); padding: 20px; text-align: center; margin: 10px 0; }
        .vault-data { filter: blur(10px); opacity: 0.2; transition: 0.5s; font-size: 1.5rem; font-weight: bold; }
        .vault-data.visible { filter: blur(0); opacity: 1; }

        /* ì†Œì„¤ ë³¸ë¬¸ ì ê¸ˆ ìŠ¤íƒ€ì¼ */
        .locked-content { background: #eee; padding: 40px; text-align: center; border: 1px dashed #bbb; color: #777; font-weight: bold; }
        .novel-body { white-space: pre-wrap; line-height: 1.8; font-size: 1.1rem; padding: 20px; background: #fff; border-left: 4px solid var(--navy); }
    </style>
</head>
<body>

<nav>
    <div class="nav-links">
        <a onclick="go('home')">HOME</a>
        <a onclick="go('writer')">WRITER</a>
        <a onclick="go('reader')">READER</a>
        <a onclick="go('mypage')">MY PAGE</a>
        <a onclick="go('admin')" id="nav-admin" style="display:none;">ADMIN</a>
    </div>
    <div id="user-status"></div>
</nav>

<header>
    <h1>RIVAL, RE; VIVAL</h1>
    <p>BAUHAUS INSPIRED PUBLISHING PLATFORM</p>
</header>

<div class="container">
    <div id="page-home" class="page">
        <div id="login-form" class="card">
            <h3>LOGIN / JOIN</h3>
            <input type="text" id="uid" placeholder="ì•„ì´ë””">
            <input type="password" id="upw" placeholder="ë¹„ë°€ë²ˆí˜¸">
            <button class="btn" onclick="login()">ë¡œê·¸ì¸</button>
            <hr style="margin:20px 0;">
            <input type="text" id="reg-id" placeholder="ìƒˆ ì•„ì´ë””">
            <input type="text" id="reg-name" placeholder="ì´ë¦„">
            <select id="reg-role"><option value="writer">ì‘ê°€</option><option value="reader">ë…ì</option></select>
            <button class="btn" style="background:#ddd; color:#333;" onclick="signup()">íšŒì›ê°€ì…</button>
        </div>
        <div id="welcome-msg" class="card hidden">
            <h2 id="hello-text"></h2>
            <p>"ë³¸ í”Œë«í¼ì€ ê´€ë¦¬ìì˜ ì‹œì„ ìœ¼ë¡œë¶€í„° ì‘ê°€ì˜ ìì¡´ì‹¬ì„ ë³´í˜¸í•©ë‹ˆë‹¤."</p>
        </div>
    </div>

    <div id="page-writer" class="page hidden">
        <div class="card">
            <h3>ì›ê³  íˆ¬ê³ </h3>
            <input type="text" id="title" placeholder="ì œëª©">
            <textarea id="content" rows="10" placeholder="ë‚´ìš©"></textarea>
            <button class="btn" onclick="submitNovel()">íˆ¬ê³ í•˜ê¸°</button>
        </div>
    </div>

    <div id="page-reader" class="page hidden">
        <div id="reader-list" class="card">
            <h3>íˆ¬ê³ ëœ ì›ê³  ë¦¬ìŠ¤íŠ¸</h3>
            <div id="novel-list"></div>
        </div>
        <div id="reader-detail" class="card hidden">
            <button onclick="go('reader')" style="margin-bottom:10px;">â† ë’¤ë¡œê°€ê¸°</button>
            <div id="detail-area"></div>
        </div>
    </div>

    <div id="page-mypage" class="page hidden">
        <div class="card">
            <h3>ë‚˜ì˜ ëŒ€ì‹œë³´ë“œ (ë¹„ë°€ ê¸ˆê³ )</h3>
            <div id="my-novels"></div>
        </div>
    </div>

    <div id="page-admin" class="page hidden">
        <div class="card">
            <h3>ê´€ë¦¬ì ëª¨ë“œ (ìˆ˜ì¹˜ ë´‰ì¸ ì¤‘)</h3>
            <div id="admin-list"></div>
        </div>
    </div>
</div>

<script>
    let users = JSON.parse(localStorage.getItem('users')) || [];
    let novels = JSON.parse(localStorage.getItem('novels')) || [];
    let me = JSON.parse(localStorage.getItem('me')) || null;
    let votes = JSON.parse(localStorage.getItem('votes')) || {}; // { userId: [novelId, novelId...] }

    function go(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
        document.getElementById('page-' + pageId).classList.remove('hidden');
        if(pageId === 'reader') {
            document.getElementById('reader-list').classList.remove('hidden');
            document.getElementById('reader-detail').classList.add('hidden');
            renderNovels();
        }
        if(pageId === 'mypage') renderMyPage();
        if(pageId === 'admin') renderAdmin();
        checkUser();
    }

    function signup() {
        const id = document.getElementById('reg-id').value;
        const name = document.getElementById('reg-name').value;
        const role = document.getElementById('reg-role').value;
        const pw = document.getElementById('upw').value;
        if(!id || !name || !pw) return alert("ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.");
        users.push({id, name, role, pw});
        localStorage.setItem('users', JSON.stringify(users));
        alert("íšŒì›ê°€ì… ì™„ë£Œ!");
    }

    function login() {
        const id = document.getElementById('uid').value;
        const pw = document.getElementById('upw').value;
        if(id === 'admin' && pw === 'kt91107361!') {
            me = {id: 'admin', name: 'ê´€ë¦¬ì', role: 'admin'};
        } else {
            const user = users.find(u => u.id === id && u.pw === pw);
            if(!user) return alert("íšŒì›ì •ë³´ê°€ ì—†ê±°ë‚˜ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë¦½ë‹ˆë‹¤.");
            me = user;
        }
        localStorage.setItem('me', JSON.stringify(me));
        checkUser();
    }

    function logout() { me = null; localStorage.removeItem('me'); location.reload(); }

    function checkUser() {
        const status = document.getElementById('user-status');
        if(me) {
            status.innerHTML = `${me.name}ë‹˜ [ <a onclick="logout()" style="color:white; cursor:pointer;">LOGOUT</a> ]`;
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('welcome-msg').classList.remove('hidden');
            document.getElementById('hello-text').innerText = `WELCOME, ${me.name}.`;
            if(me.id === 'admin') document.getElementById('nav-admin').style.display = 'inline-block';
        } else {
            status.innerHTML = "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.";
        }
    }

    function submitNovel() {
        if(!me || me.role !== 'writer') return alert("ì‘ê°€ íšŒì›ë§Œ íˆ¬ê³  ê°€ëŠ¥í•©ë‹ˆë‹¤.");
        const t = document.getElementById('title').value;
        const c = document.getElementById('content').value;
        if(!t || !c) return alert("ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.");
        novels.push({id: Date.now(), authorId: me.id, author: me.name, title: t, content: c, stars: 0});
        localStorage.setItem('novels', JSON.stringify(novels));
        alert("ì›ê³ ê°€ íˆ¬ê³ ë˜ì—ˆìŠµë‹ˆë‹¤.");
        go('reader');
    }

    function renderNovels() {
        const area = document.getElementById('novel-list');
        area.innerHTML = novels.map(n => `
            <div style="border-bottom:1px solid #eee; padding:15px; cursor:pointer;" onclick="viewNovel(${n.id})">
                <b>ã€${n.title}ã€</b> - ${n.author}
                <span style="float:right; color:var(--navy); font-size:0.8rem;">ê°ìƒí•˜ê¸° ></span>
            </div>
        `).join('') || "íˆ¬ê³ ëœ ì†Œì„¤ì´ ì—†ìŠµë‹ˆë‹¤.";
    }

    function viewNovel(id) {
        const n = novels.find(x => x.id === id);
        const detail = document.getElementById('reader-detail');
        const area = document.getElementById('detail-area');
        
        // íˆ¬í‘œ ì—¬ë¶€ í™•ì¸
        const hasVoted = me && votes[me.id] && votes[me.id].includes(id);

        document.getElementById('reader-list').classList.add('hidden');
        detail.classList.remove('hidden');

        area.innerHTML = `
            <h2>ã€${n.title}ã€</h2>
            <p>ì‘ê°€: ${n.author}</p>
            <hr>
            ${hasVoted ? 
                `<div class="novel-body">${n.content}</div>` : 
                `<div class="locked-content">
                    <p>ğŸ”’ ì´ ì†Œì„¤ì˜ ì „ë¬¸ì€ ë³„ì ì„ ë˜ì§„ ë¦¬ë”(Reader)ì—ê²Œë§Œ ê³µê°œë©ë‹ˆë‹¤.</p>
                    <button class="btn" onclick="addStar(${n.id})" style="width:200px;">ë³„ì  ë˜ì§€ê³  ì½ê¸° (500ì›)</button>
                </div>`
            }
        `;
    }

    function addStar(id) {
        if(!me) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.");
        const idx = novels.findIndex(n => n.id === id);
        
        // íˆ¬í‘œ ê¸°ë¡ ì—…ë°ì´íŠ¸
        if(!votes[me.id]) votes[me.id] = [];
        if(votes[me.id].includes(id)) return alert("ì´ë¯¸ ë³„ì ì„ ì£¼ì…¨ìŠµë‹ˆë‹¤.");
        
        novels[idx].stars += 1;
        votes[me.id].push(id);
        
        localStorage.setItem('novels', JSON.stringify(novels));
        localStorage.setItem('votes', JSON.stringify(votes));
        
        alert("ë³„ì ì„ ì£¼ì…¨ìŠµë‹ˆë‹¤! ì´ì œ ì›ê³  ì „ë¬¸ì„ ì½ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
        viewNovel(id); // ì¦‰ì‹œ ë‚´ìš© ê³µê°œ
    }

    function renderMyPage() {
        const area = document.getElementById('my-novels');
        if(!me) return;
        const my = novels.filter(n => n.authorId === me.id);
        area.innerHTML = my.map(n => `
            <div class="vault-box">
                <b>ã€${n.title}ã€</b>
                <div id="v-${n.id}" class="vault-data">â˜… ${n.stars}</div>
                <button class="btn" style="margin-top:10px; padding:5px; font-size:0.7rem;" onclick="document.getElementById('v-${n.id}').classList.toggle('visible')">ìì¡´ì‹¬ ê¸ˆê³  ì—´ê¸°/ë‹«ê¸°</button>
            </div>
        `).join('') || "íˆ¬ê³  ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.";
    }

    function renderAdmin() {
        const area = document.getElementById('admin-list');
        area.innerHTML = novels.map(n => `<div style="padding:5px;">ã€${n.title}ã€ - [ìˆ˜ì¹˜ ë´‰ì¸ ìƒíƒœ]</div>`).join('');
    }

    go('home');
</script>

</body>
</html>
